{
  "monitors": [
    {
      "name": "LLM p95 Latency SLO Burn",
      "type": "metric alert",
      "query": "avg(last_5m):p95:llm.request.latency_ms{service:llm-reliability-control-plane} > 1500",
      "message": "ðŸš¨ **What failed?** p95 latency is breaching SLO threshold (1500ms).\n\n**Why did it fail?** Possible causes:\n- Model overload or rate limiting\n- Upstream Vertex AI latency spike\n- Network issues\n- Recent deployment or config change\n\n**What should the engineer do next?**\n1. Check Datadog APM traces for slow spans\n2. Review recent deployments in the timeline\n3. Check Vertex AI service status\n4. Consider: downgrade model, enable caching, or scale up\n\n**Attached context:** Dashboard, logs, and traces are automatically attached to this incident.",
      "tags": ["llm", "latency", "slo", "critical"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Latency SLO breach still active. Check dashboard for trends.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-2",
        "attach_dashboard": true,
        "attach_logs": true,
        "attach_traces": true
      }
    },
    {
      "name": "LLM Cost Anomaly Detection",
      "type": "metric alert",
      "query": "avg(last_5m):sum:llm.cost.usd{service:llm-reliability-control-plane} > 8e-05",
      "message": "ðŸš¨ **What failed?** LLM cost has spiked above the expected threshold while traffic remains stable.\n\n**Why did it fail?** Possible causes:\n- Long context prompts consuming excessive tokens\n- Model upgrade to more expensive tier\n- Prompt engineering changes causing token bloat\n- Token abuse or prompt injection attack\n\n**What should the engineer do next?**\n1. Review cost breakdown by endpoint in dashboard\n2. Check token usage trends (input vs output)\n3. Investigate recent prompt changes\n4. Consider: downgrade model tier, enable response caching, implement rate limiting, or add prompt length limits\n\n**Attached context:** Cost dashboard, token metrics, and recent request logs are attached.",
      "tags": ["llm", "cost", "anomaly", "critical"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Cost anomaly persists. Review token usage patterns.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-3",
        "attach_dashboard": true,
        "attach_logs": true
      }
    },
    {
      "name": "LLM Error Burst / Retry Storm",
      "type": "metric alert",
      "query": "sum(last_5m):sum:llm.error.count{service:llm-reliability-control-plane} > 10",
      "message": "ðŸš¨ **What failed?** Error rate has spiked (>10 errors in 5 minutes).\n\n**Why did it fail?** Possible causes:\n- Vertex AI service degradation\n- Authentication/authorization failures\n- Rate limit exceeded\n- Network connectivity issues\n- Invalid prompt format causing API errors\n\n**What should the engineer do next?**\n1. Check error logs for specific error messages\n2. Review APM traces for failed requests\n3. Verify Vertex AI service status\n4. Check authentication credentials\n5. Review retry logic and backoff strategy\n6. Consider: implement circuit breaker, add retry limits, or failover to backup model\n\n**Attached context:** Error logs, failed traces, and error breakdown by endpoint are attached.",
      "tags": ["llm", "reliability", "errors", "critical"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Error burst continues. Check Vertex AI status and credentials.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-1",
        "attach_dashboard": true,
        "attach_logs": true,
        "attach_traces": true
      }
    },
    {
      "name": "LLM Quality Degradation",
      "type": "metric alert",
      "query": "avg(last_10m):avg:llm.semantic_similarity_score{service:llm-reliability-control-plane} < 0.4",
      "message": "ðŸš¨ **What failed?** Semantic similarity score has dropped below acceptable threshold (0.4).\n\n**Why did it fail?** Possible causes:\n- Model drift or degradation\n- Prompt engineering changes causing poor responses\n- Context quality issues\n- Model version change\n- Training data contamination\n\n**What should the engineer do next?**\n1. Review quality metrics dashboard for trends\n2. Sample recent responses from logs\n3. Compare current vs baseline similarity scores\n4. Check for recent model or prompt changes\n5. Consider: rollback model version, update prompts, or retrain model\n\n**Attached context:** Quality dashboard, sample responses, and similarity score history are attached.",
      "tags": ["llm", "quality", "degradation"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Quality degradation persists. Review sample responses.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-2",
        "attach_dashboard": true,
        "attach_logs": true
      }
    },
    {
      "name": "LLM Safety Block Surge",
      "type": "metric alert",
      "query": "sum(last_10m):sum:llm.safety_block.count{service:llm-reliability-control-plane} > 5",
      "message": "ðŸš¨ **What failed?** Safety intervention blocks have surged (>5 in 10 minutes).\n\n**Why did it fail?** Possible causes:\n- Prompt injection attacks\n- Malicious user input\n- Misconfigured safety filters\n- False positives from safety policies\n- Content policy violations\n\n**What should the engineer do next?**\n1. Review blocked prompts in logs\n2. Check for patterns indicating attack (prompt injection, jailbreak attempts)\n3. Verify safety filter configuration\n4. Consider: tighten input validation, update safety policies, or investigate user behavior\n5. If false positives: adjust safety thresholds\n\n**Attached context:** Safety logs, blocked request samples, and security dashboard are attached.",
      "tags": ["llm", "safety", "security"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Safety blocks continue. Review security dashboard.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-2",
        "attach_dashboard": true,
        "attach_logs": true
      }
    },
    {
      "name": "LLM Health Score Degradation",
      "type": "metric alert",
      "query": "avg(last_10m):avg:llm.health_score{service:llm-reliability-control-plane} < 60",
      "message": "ðŸš¨ **What failed?** Composite health score has dropped below 60 (degraded threshold).\n\n**Why did it fail?** The health score combines performance, reliability, cost, quality, and security metrics. A low score indicates multiple issues across these dimensions.\n\n**What should the engineer do next?**\n1. Call `/insights` endpoint for AI-powered recommendations\n2. Review component scores (performance, reliability, cost, quality, security)\n3. Check individual monitors for specific issues\n4. Review predictive insights for trending problems\n5. Implement top priority recommendations from insights API\n\n**Attached context:** Health score breakdown, insights recommendations, and component metrics are attached.",
      "tags": ["llm", "health", "composite", "innovation"],
      "options": {
        "notify_audit": true,
        "require_full_window": false,
        "notify_no_data": false,
        "renotify_interval": 0,
        "escalation_message": "Health score remains degraded. Review insights endpoint for recommendations.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-2",
        "attach_dashboard": true,
        "attach_logs": true
      }
    },
    {
      "name": "LLM Daily Cost Budget Alert",
      "type": "metric alert",
      "query": "sum(last_24h):sum:llm.cost.usd{service:llm-reliability-control-plane} > 1.0",
      "message": "ðŸš¨ **What failed?** Daily LLM cost budget exceeded ($1.00).\n\n**Why did it fail?** Possible causes:\n- Unusually high traffic volume\n- Cost spike from long context prompts\n- Model upgrade to more expensive tier\n- Token abuse or prompt injection attack\n\n**What should the engineer do next?**\n1. Review cost breakdown by endpoint and time period\n2. Check for unusual traffic patterns\n3. Investigate recent model or prompt changes\n4. Consider: implement rate limiting, downgrade model tier, enable caching, or add cost controls\n5. Review cost optimization recommendations from `/insights` endpoint\n\n**Attached context:** Cost dashboard, daily cost trends, and cost breakdown by endpoint are attached.",
      "tags": ["llm", "cost", "budget", "critical"],
      "options": {
        "notify_audit": true,
        "require_full_window": true,
        "notify_no_data": false,
        "renotify_interval": 3600,
        "escalation_message": "Daily cost budget still exceeded. Review cost optimization recommendations.",
        "new_host_delay": 300,
        "evaluation_delay": 60,
        "include_tags": true,
        "thresholds": {
          "critical": 1.0,
          "warning": 0.8
        }
      },
      "incident_config": {
        "create_incident": true,
        "incident_severity": "SEV-2",
        "attach_dashboard": true,
        "attach_logs": true
      }
    }
  ]
}
